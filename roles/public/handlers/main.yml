---
- name: sshd-restart
  ansible.builtin.systemd_service:
    name: sshd
    enabled: true
    state: restarted
    daemon-reload: true

- name: certbot-timer-restart
  ansible.builtin.systemd_service:
    name: certbot.timer
    state: restarted
    enabled: true
    daemon_reload: true

- name: nginx-verify-config
  ansible.builtin.command: nginx -t
  changed_when: false
  failed_when: "'test failed' in nginx_test_output.stderr"
  register: nginx_test_output
  listen: nginx-reload

- name: nginx-reload
  ansible.builtin.systemd_service:
    name: nginx
    state: reloaded
    enabled: true
  listen: nginx-reload

- name: portfolio-restart
  ansible.builtin.systemd_service:
    name: portfolio
    state: restarted
    enabled: true
    daemon_reload: true
